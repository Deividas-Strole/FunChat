<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Welcome</title>
    <link rel="stylesheet" href="bg.css">
    <style>
        #channel-selector {
            display: none;
        }
    </style>
</head>
<body>
<div class="bg"></div>
<div class="bg bg2"></div>
<div class="bg bg3"></div>
<div class="content">
    <h1>WELCOME TO FUN CHAT</h1>
    <form action="/channels" method="post" onsubmit="storeNameInSession(); return true;">
        <input type="hidden" id="isNewField" name="isNew" value="true">
        <div id="name-input">
            <label>Enter your name:</label>
            <p>
                <input type="text" id="nameTextBox" name="name" oninput="toggleChannelSelector()">
            </p>
        </div>
        <div id="channel-selector">
            <label>Channel:</label>
            <select id="channelSelected" name="channel" onchange="checkForDuplicateName()">
                <option value="" disabled selected>Select a channel</option>
                <option value="First">Channel 1</option>
                <option value="Second">Channel 2</option>
                <option value="Third">Channel 3</option>
                <option value="Fourth">Channel 4</option>
            </select>
<!--            <select id="channelSelected" name="channel">-->
<!--                <option value="First">Channel 1</option>-->
<!--                <option value="Second">Channel 2</option>-->
<!--                <option value="Third">Channel 3</option>-->
<!--                <option value="Fourth">Channel 4</option>-->
<!--            </select>-->
            <button id="button" type="submit">Submit</button>
        </div>
    </form>
</div>

<script>
    // Load name from sessionStorage on page load
    window.onload = function() {
        const savedName = sessionStorage.getItem("userName");
        const nameTextBox = document.getElementById("nameTextBox");
        const channelSelector = document.getElementById("channel-selector");
        const nameInput = document.getElementById("name-input");
        var isNew = "true";

        if (savedName) {
            console.log("entered savedName if statement: " + savedName);
            nameTextBox.value = savedName;
            nameInput.style.display = "none";
            channelSelector.style.display = "block";
            document.getElementById("isNewField").value = "false";
        }
    };

    function toggleChannelSelector() {
        const nameTextBox = document.getElementById("nameTextBox");
        const channelSelector = document.getElementById("channel-selector");

        if (nameTextBox.value.trim() !== "") {
            channelSelector.style.display = "block"; // Show if text is present
        } else {
            channelSelector.style.display = "none"; // Hide if empty
        }
    }

    function storeNameInSession() {
        const nameTextBox = document.getElementById("nameTextBox");
        const name = nameTextBox.value.trim();

        if (name) {
            sessionStorage.setItem("userName", name); // Store name in sessionStorage
            console.log("********sessionStorage.setItem:", sessionStorage.getItem(name));
        }
    }

    function checkForDuplicateName() {

        const channelSelected = document.getElementById("channelSelected").value;
        const name = document.getElementById("nameTextBox");
        console.log(`Channel selected + name: ${channelSelected} + ${name.value}`);

        const savedName = sessionStorage.getItem("userName"); // Replace "userName" with your sessionStorage key

         console.log("name.value + savedName" + name.value + savedName);



         if (savedName) {
             console.log("Name found in sessionStorage:" + name.value);
                //return true; // Name exists in sessionStorage
         } else {




        fetch('/checkDuplicate', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `channel=${encodeURIComponent(channelSelected)}&name=${encodeURIComponent(name.value)}`
        })
        .then(response => response.text())
        .then(data => {
             console.log("Response from server:", data);
             // Process the server response
             if (data === "true") {
                alert("Duplicate name found for the selected channel. A select channel can have only unique names. Please choose another name. Thank you!");
                name.value = "";
                toggleChannelSelector();
            }
         })
          .catch(error => {
            console.error("Error:", error);
         });

    }
    }

</script>
</body>
</html>




<!--<!DOCTYPE html>-->
<!--<html>-->
<!--    <head>-->
<!--        <meta charset="UTF-8">-->
<!--        <title>Welcome</title>-->
<!--        <link rel="stylesheet" href="bg.css">-->
<!--        <style>-->
<!--            #channel-selector {-->
<!--            display: none;-->
<!--        }-->
<!--        </style>-->
<!--    </head>-->
<!--    <body>-->
<!--    <div class="bg"></div>-->
<!--    <div class="bg bg2"></div>-->
<!--    <div class="bg bg3"></div>-->
<!--    <div class="content">-->
<!--        <h1>WELCOME TO FUN CHAT</h1>-->
<!--        <form action="/channels" method="post">-->
<!--            <label>Enter your name:</label>-->
<!--            <p>-->
<!--                <input type="text" id="nameTextBox" name="name" oninput="toggleChannelSelector()">-->
<!--            </p>-->
<!--            <div id="channel-selector">-->
<!--                <label>Choose chat channel:</label>-->
<!--                    <select id="channelSelected" name="channel">-->
<!--                        <option value="First">Channel 1</option>-->
<!--                        <option value="Second">Channel 2</option>-->
<!--                        <option value="Third">Channel 3</option>-->
<!--                        <option value="Fourth">Channel 4</option>-->
<!--                    </select>-->
<!--                <button id="button" type="submit">Submit</button>-->
<!--            </div>-->
<!--        </form>-->
<!--    </div>-->
<!--    <script>-->
<!--        function toggleChannelSelector() {-->
<!--            const nameTextBox = document.getElementById("nameTextBox");-->
<!--            const channelSelector = document.getElementById("channel-selector");-->

<!--            if (nameTextBox.value.trim() !== "") {-->
<!--                channelSelector.style.display = "block";-->
<!--            } else {-->
<!--                channelSelector.style.display = "none";-->
<!--            }-->
<!--        }-->
<!--    </script>-->
<!--    </body>-->
<!--</html>-->